<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>고등어 – 업적/아이콘 선택</title>

  <!-- 공통 스타일 -->
  <link rel="stylesheet" href="../../assets/css/style.css">
  <!-- 페이지 전용 스타일 -->
  <link rel="stylesheet" href="../../assets/css/select.css">
</head>

<!-- 현재 위치: 마이페이지 -->
<body class="main-body" data-active="mypage">
  <div class="app">

    <!-- 헤더 (공통 포맷: 뒤로가기 + 메뉴 오버레이 버튼) -->
    <header class="app-header">
      <button class="back-btn" aria-label="뒤로 가기" onclick="history.back()">
        <img src="../../assets/images/left.svg" alt="뒤로가기"/>
      </button>
      <a href="../list.html" id="menuBtn" style="display:inline-block; cursor:pointer;">
        <img src="../../assets/images/menu.svg" alt="햄버거바"/>
      </a>
    </header>

    <!-- 본문 -->
    <main class="container">
      <!-- 획득 업적 -->
      <section class="sec">
        <h2 class="sec-title">획득 업적</h2>
        <div class="panel achievements" id="achievements">
          <button class="tag t-red"     data-value="그랜드 마스터">그랜드 마스터</button>
          <button class="tag t-pink"    data-value="마스터">마스터</button>
          <button class="tag t-blue"    data-value="다이아">다이아</button>
          <button class="tag t-teal"    data-value="플래티넘">플래티넘</button>
          <button class="tag t-gold"    data-value="골드">골드</button>
          <button class="tag t-silver"  data-value="실버">실버</button>
          <button class="tag t-bronze"  data-value="브론즈">브론즈</button>
          <button class="tag t-gray"    data-value="일반 고등어">일반 고등어</button>
          <button class="tag t-gray"    data-value="일반 삼치">일반 삼치</button>
        </div>
      </section>

      <!-- 획득 아이콘 -->
      <section class="sec">
        <h2 class="sec-title">획득 아이콘</h2>
        <div class="panel icons" id="icons">
          <button class="icon-card" data-src="../../assets/images/fish.svg" data-label="일반 고등어">
            <span class="thumb"><img src="../../assets/images/fish.svg" alt="일반 고등어"/></span>
            <span class="label">일반<br/>고등어</span>
          </button>

          <button class="icon-card" data-src="../../assets/images/fish_crown.svg" data-label="왕관 고등어">
            <span class="thumb"><img src="../../assets/images/fish_crown.svg" alt="왕관 고등어"/></span>
            <span class="label">왕관<br/>고등어</span>
          </button>
        </div>
      </section>
    </main>

    <!-- 하단 고정 버튼 -->
    <div class="footer">
      <button id="applyBtn" class="primary-btn" type="button">
        <img src="../../assets/images/send.svg" class="icon-send" alt="" />
        적용 완료
      </button>
    </div>
  </div>

  <!-- ===== 공통 메뉴 오버레이 ===== -->
  <div class="menu-overlay" id="menuOverlay" aria-hidden="true">
    <button class="menu-close" id="menuClose" aria-label="닫기">✕</button>

    <div class="menu-logo">
      <img src="../../assets/images/logo_app.svg" alt="고등어" />
    </div>

    <nav class="menu-nav">
      <a href="../index.html" class="menu-item" data-menu="home">메인페이지</a>

      <!-- 게시판 아코디언: 버튼 + 서브메뉴 -->
      <button id="boardToggle" class="menu-accordion-btn" type="button" aria-expanded="false">
        게시판
        <img src="../../assets/images/down.svg" alt="" class="chev" aria-hidden="true">
      </button>
      <ul id="boardSub" class="submenu" hidden>
        <li><a href="../board/board.html"      class="submenu-item">자유게시판</a></li>
        <li><a href="../board/board.html#anon" class="submenu-item">익명게시판</a></li>
        <li><a href="../board/board.html#qna"  class="submenu-item">질문게시판</a></li>
      </ul>

      <a href="../ranking/ranking.html" class="menu-item" data-menu="ranking">랭킹</a>
      <a href="../class/class.html"     class="menu-item" data-menu="tasks">수행평가</a>
      <a href="./mypage.html"           class="menu-item" data-menu="mypage">마이페이지</a>
    </nav>

    <div class="menu-auth">
      <a href="../login.html">로그인</a> | <a href="../signup.html">회원가입</a>
    </div>
  </div>

  <!-- 페이지 전용 스크립트 (선택 저장 로직) -->
  <script>
    // 키 이름
    const LS_ACHV = 'selectedAchievement';
    const LS_ICON_SRC = 'selectedProfileIconSrc';
    const LS_ICON_LABEL = 'selectedProfileIconLabel';

    const savedAchv = localStorage.getItem(LS_ACHV);
    const savedIcon = localStorage.getItem(LS_ICON_SRC);

    // 업적 선택
    const achvWrap = document.getElementById('achievements');
    let currentAchv = savedAchv || null;

    achvWrap.addEventListener('click', (e) => {
      const btn = e.target.closest('.tag');
      if (!btn) return;
      achvWrap.querySelectorAll('.tag.active').forEach(el => el.classList.remove('active'));
      btn.classList.add('active');
      currentAchv = btn.dataset.value;
    });

    // 아이콘 선택
    const iconsWrap = document.getElementById('icons');
    let currentIconSrc = savedIcon || null;
    let currentIconLabel = localStorage.getItem(LS_ICON_LABEL) || '';

    iconsWrap.addEventListener('click', (e) => {
      const card = e.target.closest('.icon-card');
      if (!card) return;
      iconsWrap.querySelectorAll('.icon-card.active').forEach(el => el.classList.remove('active'));
      card.classList.add('active');
      currentIconSrc = card.dataset.src;
      currentIconLabel = card.dataset.label || '';
    });

    // 초기 표시(저장값 하이라이트)
    if (savedAchv) {
      const btn = achvWrap.querySelector(`.tag[data-value="${savedAchv}"]`);
      if (btn) btn.classList.add('active');
    }
    if (savedIcon) {
      const card = iconsWrap.querySelector(`.icon-card[data-src="${savedIcon}"]`);
      if (card) card.classList.add('active');
    }

    // 적용 버튼
    document.getElementById('applyBtn').addEventListener('click', () => {
      if (currentAchv) localStorage.setItem(LS_ACHV, currentAchv);
      if (currentIconSrc) {
        localStorage.setItem(LS_ICON_SRC, currentIconSrc);
        localStorage.setItem(LS_ICON_LABEL, currentIconLabel);
      }
      history.back();
    });
  </script>

  <!-- 공통 JS: 메뉴 열기/닫기 + 게시판 아코디언 토글 -->
  <script defer src="../../assets/js/main.js"></script>
</body>
</html>
