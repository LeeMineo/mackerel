<!-- board/write.html 페이지 -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>board/write</title>

  <!-- 공통 스타일 -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/write.css">
</head>

<!-- 현재 위치 표시: tasks(수행평가) (스켈레톤 유지) -->
<body class="main-body" data-active="tasks">
  <div class="app">
    <!-- 헤더 -->
    <header class="app-header">
      <button class="back-btn" aria-label="뒤로 가기" onclick="location.href='/pages/board/board.html#free'">
        <img src="/assets/images/left.svg" alt="뒤로가기"/>
      </button>

      <p class="title">글 작성</p>

      <a href="/pages/list.html" id="menuBtn" style="display:inline-block; cursor:pointer;">
        <img src="/assets/images/menu.svg" alt="햄버거바" />
      </a>
    </header>

    <!-- 본문 -->
    <main class="container write-container" id="writeApp" aria-live="polite">
      <!-- 카테고리 선택 -->
      <div class="field">
        <button id="cateToggle" class="cate-pill" type="button" aria-haspopup="listbox" aria-expanded="false">
          <span id="cateLabel">자유게시판</span>
          <img class="chev" src="/assets/images/down.svg" alt="" aria-hidden="true">
        </button>
        <ul id="cateList" class="cate-dropdown" role="listbox" hidden>
          <li role="option"><a href="#" data-cate="free">자유게시판</a></li>
          <li role="option"><a href="#" data-cate="anon">익명게시판</a></li>
          <li role="option"><a href="#" data-cate="qna">질문게시판</a></li>
        </ul>
      </div>

      <!-- 제목 -->
      <div class="field">
        <input id="titleInput" class="title-input" type="text" placeholder="제목을 입력해주세요.">
      </div>

      <!-- 내용 -->
      <div class="field">
        <textarea id="bodyInput" class="body-input" rows="14" placeholder="내용을 입력해주세요."></textarea>
      </div>

      <!-- 파일 첨부 -->
      <div class="attach">
        <label for="fileInput" class="attach-btn">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <path d="M3 6a4 4 0 0 1 4-4h7a2 2 0 0 1 1.41.59l4 4A2 2 0 0 1 20 8v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V6Z" fill="#FFB200"/>
          </svg>
          <span>파일 첨부</span>
        </label>
        <input id="fileInput" type="file" multiple hidden />
        <ul id="fileList" class="file-list"></ul>
      </div>

      <!-- 하단 고정 버튼 -->
      <button id="submitBtn" class="submit-btn" type="button" aria-label="작성 완료">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" fill="#fff"/>
        </svg>
        작성 완료
      </button>
    </main>
  </div>

  <!-- === 공통 메뉴 오버레이 === -->
  <div class="menu-overlay" id="menuOverlay" aria-hidden="true">
    <button class="menu-close" id="menuClose" aria-label="닫기">✕</button>

    <div class="menu-logo">
      <img src="/assets/images/logo_app.svg" alt="고등어" />
    </div>

    <nav class="menu-nav">
      <a href="/pages/index.html" class="menu-item" data-menu="home">메인페이지</a>

      <!-- 게시판 아코디언 -->
      <button id="boardToggle" class="menu-accordion-btn" type="button" aria-expanded="false">
        게시판
        <img src="/assets/images/down.svg" alt="" class="chev" aria-hidden="true">
      </button>
      <ul id="boardSub" class="submenu" hidden>
        <li><a href="/pages/board/board.html"      class="submenu-item">자유게시판</a></li>
        <li><a href="/pages/board/board.html#anon" class="submenu-item">익명게시판</a></li>
        <li><a href="/pages/board/board.html#qna"  class="submenu-item">질문게시판</a></li>
      </ul>

      <a href="/pages/ranking/ranking.html" class="menu-item" data-menu="ranking">랭킹</a>
      <a href="/pages/class/class.html"     class="menu-item" data-menu="tasks">수행평가</a>
      <a href="/pages/mypage/mypage.html"   class="menu-item" data-menu="mypage">마이페이지</a>
    </nav>

    <div class="menu-auth">
      <a href="/pages/login.html">로그인</a> | <a href="/pages/signup.html">회원가입</a>
    </div>
  </div>

  <!-- 공통 스크립트 -->
  <script defer src="/assets/js/main.js"></script>

  <!-- 페이지 전용 스크립트 -->
  <script>
    // ---------- 간단 로컬스토리지 키 ----------
    const STORAGE_KEY = id => `POST_${id}`;

    // 카테고리 상태
    const CATE_NAME = { free:'자유게시판', anon:'익명게시판', qna:'질문게시판' };
    const state = { cate: 'free' }; // 기본 자유

    const $  = (s, p=document) => p.querySelector(s);
    const $$ = (s, p=document) => [...p.querySelectorAll(s)];

    // 드롭다운 토글
    const toggleBtn = $('#cateToggle');
    const listEl    = $('#cateList');
    const labelEl   = $('#cateLabel');

    toggleBtn.addEventListener('click', () => {
      const open = !listEl.hasAttribute('hidden');
      if (open) {
        listEl.setAttribute('hidden','');
        toggleBtn.setAttribute('aria-expanded','false');
        toggleBtn.classList.remove('open');
      } else {
        listEl.removeAttribute('hidden');
        toggleBtn.setAttribute('aria-expanded','true');
        toggleBtn.classList.add('open');
      }
    });

    // 항목 선택
    $$('#cateList a').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        state.cate = a.dataset.cate;
        labelEl.textContent = CATE_NAME[state.cate];
        listEl.setAttribute('hidden','');
        toggleBtn.setAttribute('aria-expanded','false');
        toggleBtn.classList.remove('open');
      });
    });

    // 파일 표시
    const fileInput = $('#fileInput');
    const fileList  = $('#fileList');
    fileInput.addEventListener('change', () => {
      fileList.innerHTML = [...fileInput.files].map(f => `<li>${f.name}</li>`).join('');
    });

    // 작성 완료
    $('#submitBtn').addEventListener('click', () => {
      const title = $('#titleInput').value.trim();
      const body  = $('#bodyInput').value.trim();

      if (!title) { alert('제목을 입력해주세요.'); return; }
      if (!body)  { alert('내용을 입력해주세요.'); return; }

      const id = Date.now(); // 간단한 ID
      const newPost = {
        id,
        category: state.cate,
        school: '포항고',
        authorId: 'me-001',
        authorName: state.cate === 'anon' ? '익명' : '익명', // 데모용
        time: nowHHMM(),
        title,
        body,
        likes: 0,
        liked: false,
        comments: [] // 새 글이니 비어 있음
      };

      localStorage.setItem(STORAGE_KEY(id), JSON.stringify(newPost));

      // 상세 페이지로 이동
      location.href = `/pages/board/board_detail.html?id=${id}`;
    });

    function nowHHMM() {
      const d = new Date();
      const mm = String(d.getMinutes()).padStart(2,'0');
      const hh = String(d.getHours()).padStart(2,'0');
      return `${hh}:${mm}`;
    }
  </script>
</body>
</html>
